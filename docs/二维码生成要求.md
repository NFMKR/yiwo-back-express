# åç«¯ç”Ÿæˆå°ç¨‹åºäºŒç»´ç è¦æ±‚

## æ¦‚è¿°
å‰ç«¯éœ€è¦æ‰«æå°ç¨‹åºäºŒç»´ç è¿›å…¥åº—é“ºï¼Œåç«¯ç”ŸæˆäºŒç»´ç æ—¶éœ€è¦ç¡®ä¿æ‰«æåèƒ½æ­£ç¡®è§£æå‡º `shopId`ã€‚

## å‰ç«¯æ‰«æé€»è¾‘åˆ†æ

### æ‰«æç»“æœå¤„ç†é¡ºåº

1. **ä¼˜å…ˆï¼šä» `res.path` å’Œ `res.query` è·å–**
   - å¦‚æœ `res.path` å­˜åœ¨ï¼Œä¼˜å…ˆä» `res.query.shopId` è·å–
   - å¦‚æœ `query` ä¸­æ²¡æœ‰ `shopId`ï¼Œå°è¯•ä» `query` çš„ç¬¬ä¸€ä¸ªå€¼è·å–

2. **å…¶æ¬¡ï¼šä» `res.result` å­—ç¬¦ä¸²è§£æ**
   - æ ¼å¼ï¼š`pages/inspiration/index?shopId=xxx`
   - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå– `shopId` å‚æ•°

### æœŸæœ›çš„æ‰«æç»“æœæ ¼å¼

#### æ–¹å¼ä¸€ï¼špath + query åˆ†å¼€ï¼ˆæ¨èï¼‰
```javascript
{
  path: 'pages/inspiration/index',
  query: {
    shopId: '888'  // åº—é“ºID
  },
  result: ''  // å¯ä»¥ä¸ºç©º
}
```

#### æ–¹å¼äºŒï¼šresult å­—ç¬¦ä¸²ï¼ˆå¤‡é€‰ï¼‰
```javascript
{
  result: 'pages/inspiration/index?shopId=888',
  path: '',  // å¯ä»¥ä¸ºç©º
  query: {}  // å¯ä»¥ä¸ºç©º
}
```

## åç«¯ç”ŸæˆäºŒç»´ç è¦æ±‚

### 1. ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºç  API

ä½¿ç”¨å¾®ä¿¡å®˜æ–¹çš„ `getUnlimitedQRCode` æˆ– `getQRCode` API ç”Ÿæˆå°ç¨‹åºç ã€‚

**å…³é”®å‚æ•°ï¼š**

```javascript
{
  scene: 'shopId=888',  // åœºæ™¯å€¼ï¼šåŒ…å« shopId å‚æ•°
  page: 'pages/inspiration/index',  // é¡µé¢è·¯å¾„ï¼ˆå¿…é¡»ï¼‰
  width: 430,  // äºŒç»´ç å®½åº¦ï¼ˆå¯é€‰ï¼Œé»˜è®¤430ï¼‰
  check_path: false,  // æ£€æŸ¥é¡µé¢è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼ˆå»ºè®® falseï¼‰
  env_version: 'release'  // ç¯å¢ƒç‰ˆæœ¬ï¼šrelease/trial/develop
}
```

**æˆ–è€…ä½¿ç”¨ query å‚æ•°æ–¹å¼ï¼š**

```javascript
{
  path: 'pages/inspiration/index?shopId=888',  // å®Œæ•´è·¯å¾„+å‚æ•°
  width: 430,
  check_path: false,
  env_version: 'release'
}
```

### 2. å‚æ•°æ ¼å¼è¦æ±‚

#### âœ… æ­£ç¡®æ ¼å¼ç¤ºä¾‹

```javascript
// æ–¹å¼ä¸€ï¼šä½¿ç”¨ scene å‚æ•°ï¼ˆgetUnlimitedQRCodeï¼‰
{
  scene: 'shopId=888',
  page: 'pages/inspiration/index'
}

// æ–¹å¼äºŒï¼šç›´æ¥åœ¨ path ä¸­åŒ…å«å‚æ•°ï¼ˆgetQRCodeï¼‰
{
  path: 'pages/inspiration/index?shopId=888'
}
```

#### âŒ é”™è¯¯æ ¼å¼ç¤ºä¾‹

```javascript
// é”™è¯¯1ï¼šscene å€¼ä¸åŒ…å« shopId
{
  scene: '888',  // âŒ å‰ç«¯æ— æ³•è¯†åˆ«è¿™æ˜¯ shopId
  page: 'pages/inspiration/index'
}

// é”™è¯¯2ï¼špath ä¸­ä¸åŒ…å« shopId å‚æ•°
{
  path: 'pages/inspiration/index'  // âŒ ç¼ºå°‘ shopId å‚æ•°
}

// é”™è¯¯3ï¼šä½¿ç”¨å…¶ä»–å‚æ•°å
{
  path: 'pages/inspiration/index?id=888'  // âŒ å‰ç«¯æŸ¥æ‰¾çš„æ˜¯ shopIdï¼Œä¸æ˜¯ id
}
```

### 3. åç«¯ä»£ç ç¤ºä¾‹

#### Node.js + å¾®ä¿¡å°ç¨‹åº API

```javascript
const axios = require('axios');

// è·å– Access Tokenï¼ˆéœ€è¦å…ˆè·å–ï¼‰
async function getAccessToken() {
  // å®ç°è·å– access_token çš„é€»è¾‘
  // GET https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=xxx&secret=xxx
}

// ç”Ÿæˆå°ç¨‹åºç 
async function generateShopQRCode(shopId) {
  const accessToken = await getAccessToken();
  
  // æ–¹å¼ä¸€ï¼šä½¿ç”¨ getUnlimitedQRCodeï¼ˆæ— æ•°é‡é™åˆ¶ï¼‰
  const response = await axios.post(
    `https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=${accessToken}`,
    {
      scene: `shopId=${shopId}`,  // âœ… å…³é”®ï¼šscene ä¸­åŒ…å« shopId=xxx
      page: 'pages/inspiration/index',  // âœ… å¿…é¡»æŒ‡å®šé¡µé¢è·¯å¾„
      width: 430,
      check_path: false,  // ä¸æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨
      env_version: 'release'  // æ­£å¼ç¯å¢ƒ
    },
    {
      responseType: 'arraybuffer'  // æ¥æ”¶å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®
    }
  );
  
  // æ–¹å¼äºŒï¼šä½¿ç”¨ getQRCodeï¼ˆæœ‰æ•°é‡é™åˆ¶ï¼Œä½†æ›´ç¨³å®šï¼‰
  // const response = await axios.post(
  //   `https://api.weixin.qq.com/wxa/getwxacode?access_token=${accessToken}`,
  //   {
  //     path: `pages/inspiration/index?shopId=${shopId}`,  // âœ… ç›´æ¥åœ¨ path ä¸­åŒ…å«å‚æ•°
  //     width: 430,
  //     check_path: false,
  //     env_version: 'release'
  //   },
  //   {
  //     responseType: 'arraybuffer'
  //   }
  // );
  
  // ä¸Šä¼ åˆ°äº‘å­˜å‚¨å¹¶è¿”å› URL
  // ... ä¸Šä¼ é€»è¾‘
  
  return {
    qrcodeUrl: 'https://your-cdn.com/qrcode/xxx.png'
  };
}
```

### 4. æ³¨æ„äº‹é¡¹

1. **é¡µé¢è·¯å¾„å¿…é¡»æ˜¯çœŸå®å­˜åœ¨çš„**
   - è·¯å¾„ï¼š`pages/inspiration/index`ï¼ˆä¸éœ€è¦å‰å¯¼æ–œæ ï¼‰
   - ç¡®ä¿è¯¥é¡µé¢åœ¨å°ç¨‹åºçš„ `pages.json` ä¸­å·²æ³¨å†Œ

2. **å‚æ•°åç§°å¿…é¡»ç²¾ç¡®**
   - å¿…é¡»ä½¿ç”¨ `shopId` ä½œä¸ºå‚æ•°å
   - å¤§å°å†™æ•æ„Ÿï¼š`shopId` âœ…ï¼Œ`shopid` âŒï¼Œ`ShopId` âŒ

3. **scene å‚æ•°é™åˆ¶**
   - `getUnlimitedQRCode` çš„ `scene` æœ€å¤§é•¿åº¦ä¸º 32 ä¸ªå­—ç¬¦
   - å»ºè®®æ ¼å¼ï¼š`shopId=xxx`ï¼Œå…¶ä¸­ xxx æ˜¯åº—é“ºID

4. **æ£€æŸ¥è·¯å¾„é€‰é¡¹**
   - å»ºè®®è®¾ç½® `check_path: false`ï¼Œé¿å…è·¯å¾„æ£€æŸ¥å¤±è´¥
   - ä½†å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œæ‰«æåå¯èƒ½æ— æ³•æ­£ç¡®è·³è½¬

5. **ç¯å¢ƒç‰ˆæœ¬**
   - `release`: æ­£å¼ç¯å¢ƒï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰
   - `trial`: ä½“éªŒç‰ˆ
   - `develop`: å¼€å‘ç‰ˆ

### 5. æµ‹è¯•éªŒè¯

ç”ŸæˆäºŒç»´ç åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

1. **ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·**
   - åœ¨"å·¥å…·" â†’ "é¢„è§ˆ" â†’ "æ‰«æäºŒç»´ç "
   - æ£€æŸ¥æ‰«æåçš„è·¯å¾„å’Œå‚æ•°æ˜¯å¦æ­£ç¡®

2. **çœŸæœºè°ƒè¯•**
   - ä½¿ç”¨å¾®ä¿¡æ‰«ç 
   - æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œæ£€æŸ¥ `res.path` å’Œ `res.query` æ˜¯å¦æ­£ç¡®

3. **é¢„æœŸæ—¥å¿—è¾“å‡º**
   ```
   ğŸ“ æ£€æµ‹åˆ°å°ç¨‹åºç  path å’Œ query åˆ†å¼€å­˜å‚¨
   ğŸ“ path: pages/inspiration/index
   ğŸ“ query: {"shopId":"888"}
   âœ… ä» query å¯¹è±¡ç›´æ¥è·å–åˆ° shopId: 888
   ```

## API æ¥å£è¦æ±‚

### ç”ŸæˆäºŒç»´ç æ¥å£

**è¯·æ±‚ï¼š**
```
POST /api/shop/{shopId}/qrcode
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "äºŒç»´ç ç”ŸæˆæˆåŠŸ",
  "data": {
    "qrcodeUrl": "https://cdn.example.com/qrcode/xxx.png"
  }
}
```

## æ€»ç»“

**å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼š**

1. âœ… ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºç  APIï¼ˆ`getUnlimitedQRCode` æˆ– `getQRCode`ï¼‰
2. âœ… `page` å‚æ•°è®¾ç½®ä¸º `pages/inspiration/index`
3. âœ… `scene` æˆ– `path` ä¸­åŒ…å« `shopId=xxx` æ ¼å¼çš„å‚æ•°
4. âœ… å‚æ•°åå¿…é¡»æ˜¯ `shopId`ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰
5. âœ… ç”Ÿæˆçš„äºŒç»´ç å›¾ç‰‡ä¸Šä¼ åˆ° CDN å¹¶è¿”å› URL

**æ¨èé…ç½®ï¼š**

```javascript
{
  scene: 'shopId=888',  // æˆ– path: 'pages/inspiration/index?shopId=888'
  page: 'pages/inspiration/index',
  width: 430,
  check_path: false,
  env_version: 'release'
}
```

